/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
!function(t){t.fn.drag=function(e,i,n){var o="string"==typeof e?e:"",r=t.isFunction(e)?e:t.isFunction(i)?i:null;return 0!==o.indexOf("drag")&&(o="drag"+o),n=(e==r?i:n)||{},r?this.bind(o,n,r):this.trigger(o)};var e=t.event,i=e.special,n=i.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(e){var i=t.data(this,n.datakey),o=e.data||{};i.related+=1,t.each(n.defaults,function(t){void 0!==o[t]&&(i[t]=o[t])})},remove:function(){t.data(this,n.datakey).related-=1},setup:function(){if(!t.data(this,n.datakey)){var i=t.extend({related:0},n.defaults);t.data(this,n.datakey,i),e.add(this,"touchstart mousedown",n.init,i),this.attachEvent&&this.attachEvent("ondragstart",n.dontstart)}},teardown:function(){var i=t.data(this,n.datakey)||{};i.related||(t.removeData(this,n.datakey),e.remove(this,"touchstart mousedown",n.init),n.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",n.dontstart))},init:function(o){if(!n.touched){var r,s=o.data;if(!(0!=o.which&&s.which>0&&o.which!=s.which||t(o.target).is(s.not)||s.handle&&!t(o.target).closest(s.handle,o.currentTarget).length||(n.touched="touchstart"==o.type?this:null,s.propagates=1,s.mousedown=this,s.interactions=[n.interaction(this,s)],s.target=o.target,s.pageX=o.pageX,s.pageY=o.pageY,s.dragging=null,r=n.hijack(o,"draginit",s),!s.propagates)))return r=n.flatten(r),r&&r.length&&(s.interactions=[],t.each(r,function(){s.interactions.push(n.interaction(this,s))})),s.propagates=s.interactions.length,s.drop!==!1&&i.drop&&i.drop.handler(o,s),n.textselect(!1),n.touched?e.add(n.touched,"touchmove touchend",n.handler,s):e.add(document,"mousemove mouseup",n.handler,s),!n.touched||s.live?!1:void 0}},interaction:function(e,i){var o=t(e)[i.relative?"position":"offset"]()||{top:0,left:0};return{drag:e,callback:new n.callback,droppable:[],offset:o}},handler:function(o){var r=o.data;switch(o.type){case!r.dragging&&"touchmove":o.preventDefault();case!r.dragging&&"mousemove":if(Math.pow(o.pageX-r.pageX,2)+Math.pow(o.pageY-r.pageY,2)<Math.pow(r.distance,2))break;o.target=r.target,n.hijack(o,"dragstart",r),r.propagates&&(r.dragging=!0);case"touchmove":o.preventDefault();case"mousemove":if(r.dragging){if(n.hijack(o,"drag",r),r.propagates){r.drop!==!1&&i.drop&&i.drop.handler(o,r);break}o.type="mouseup"}case"touchend":case"mouseup":default:n.touched?e.remove(n.touched,"touchmove touchend",n.handler):e.remove(document,"mousemove mouseup",n.handler),r.dragging&&(r.drop!==!1&&i.drop&&i.drop.handler(o,r),n.hijack(o,"dragend",r)),n.textselect(!0),r.click===!1&&r.dragging&&t.data(r.mousedown,"suppress.click",(new Date).getTime()+5),r.dragging=n.touched=!1}},hijack:function(i,o,r,s,a){if(r){var c,h,l,u={event:i.originalEvent,type:i.type},d=o.indexOf("drop")?"drag":"drop",f=s||0,p=isNaN(s)?r.interactions.length:s;i.type=o,i.originalEvent=null,r.results=[];do if(h=r.interactions[f]){if("dragend"!==o&&h.cancelled)continue;l=n.properties(i,r,h),h.results=[],t(a||h[d]||r.droppable).each(function(s,a){return l.target=a,i.isPropagationStopped=function(){return!1},c=a?e.dispatch.call(a,i,l):null,c===!1?("drag"==d&&(h.cancelled=!0,r.propagates-=1),"drop"==o&&(h[d][s]=null)):"dropinit"==o&&h.droppable.push(n.element(c)||a),"dragstart"==o&&(h.proxy=t(n.element(c)||h.drag)[0]),h.results.push(c),delete i.result,"dropinit"!==o?c:void 0}),r.results[f]=n.flatten(h.results),"dropinit"==o&&(h.droppable=n.flatten(h.droppable)),"dragstart"!=o||h.cancelled||l.update()}while(++f<p);return i.type=u.type,i.originalEvent=u.event,n.flatten(r.results)}},properties:function(t,e,i){var o=i.callback;return o.drag=i.drag,o.proxy=i.proxy||i.drag,o.startX=e.pageX,o.startY=e.pageY,o.deltaX=t.pageX-e.pageX,o.deltaY=t.pageY-e.pageY,o.originalX=i.offset.left,o.originalY=i.offset.top,o.offsetX=o.originalX+o.deltaX,o.offsetY=o.originalY+o.deltaY,o.drop=n.flatten((i.drop||[]).slice()),o.available=n.flatten((i.droppable||[]).slice()),o},element:function(t){return t&&(t.jquery||1==t.nodeType)?t:void 0},flatten:function(e){return t.map(e,function(e){return e&&e.jquery?t.makeArray(e):e&&e.length?n.flatten(e):e})},textselect:function(e){t(document)[e?"unbind":"bind"]("selectstart",n.dontstart).css("MozUserSelect",e?"":"none"),document.unselectable=e?"off":"on"},dontstart:function(){return!1},callback:function(){}};n.callback.prototype={update:function(){i.drop&&this.available.length&&t.each(this.available,function(t){i.drop.locate(this,t)})}};var o=e.dispatch;e.dispatch=function(e){return t.data(this,"suppress."+e.type)-(new Date).getTime()>0?void t.removeData(this,"suppress."+e.type):o.apply(this,arguments)};var r=e.fixHooks.touchstart=e.fixHooks.touchmove=e.fixHooks.touchend=e.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(e,i){if(i){var n=i.touches&&i.touches[0]||i.changedTouches&&i.changedTouches[0]||null;n&&t.each(r.props,function(t,i){e[i]=n[i]})}return e}};i.draginit=i.dragstart=i.dragend=n}(jQuery);