function toUnicode(t){var e=t.split("-").map(function(t){return parseInt(t,16)});return String.fromCodePoint.apply(null,e)}function findEmoji(t){for(var e=$.fn.emojiPicker.emojis,n=0;n<e.length;n++)if(e[n].shortcode==t)return e[n]}function rgb2hex(t){var e=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+)/i);return e&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):t}var canvas,imgElement,imgInstance,butn,cod,line_for_print,caseImage,overIm,preOverIm,imgData,overlay="/assets/cases/i6t.png",overlay_line="/assets/cases/i6t_l.png",overlay_mobile,overlay_line_mobile,text,ready=function(){if(window.matchMedia("(max-width: 767px)").matches&&(overlay="/assets/cases/i6t_mobile.png",overlay_line="/assets/cases/i6t_l_mobile.png"),createCanvas(),$("#product_phonetype_id").change(function(){2==$(this).val()||3==$(this).val()?canvas.setOverlayImage("/assets/cases/i5.png",canvas.renderAll.bind(canvas)):7==$(this).val()?canvas.setOverlayImage("/assets/cases/gs5t.png",canvas.renderAll.bind(canvas)):9==$(this).val()?canvas.setOverlayImage("/assets/cases/gs6t.png",canvas.renderAll.bind(canvas)):8==$(this).val()?canvas.setOverlayImage("/assets/cases/motog.png",canvas.renderAll.bind(canvas)):4==$(this).val()?canvas.setOverlayImage("/assets/cases/i6.png",canvas.renderAll.bind(canvas)):5==$(this).val()?canvas.setOverlayImage("/assets/cases/i6t.png",canvas.renderAll.bind(canvas)):6==$(this).val()?canvas.setOverlayImage("/assets/cases/i6pt.png",canvas.renderAll.bind(canvas)):1==$(this).val()&&canvas.setOverlayImage("/assets/cases/i4t.png",canvas.renderAll.bind(canvas))}),"admin"!==window.location.pathname.split("/")[1]){$("#phoneTypeDropDown li a").click(function(t){var e=$(t.target).text();$("#dropdownMenu3 p").html(e),"2"===t.target.id?(canvas.setOverlayImage("/assets/cases/i5.png",canvas.renderAll.bind(canvas)),overlay="/assets/cases/i5.png",overlay_line="/assets/cases/i5_l.png",$("#phone_type_name").val("2")):"3"===t.target.id?(canvas.setOverlayImage("/assets/cases/i5t.png",canvas.renderAll.bind(canvas)),overlay="/assets/cases/i5t.png",overlay_line="/assets/cases/i5t_l.png",$("#phone_type_name").val("3")):"7"===t.target.id?(canvas.setOverlayImage("/assets/cases/gs5t.png",canvas.renderAll.bind(canvas)),overlay="/assets/cases/gs5t.png",overlay_line="/assets/cases/gs5t_l.png",$("#phone_type_name").val("7")):"9"===t.target.id?(canvas.setOverlayImage("/assets/cases/gs6t.png",canvas.renderAll.bind(canvas)),overlay="/assets/cases/gs6t.png",overlay_line="/assets/cases/gs6t_l.png",$("#phone_type_name").val("9")):"8"===t.target.id?(canvas.setOverlayImage("/assets/cases/motog.png",canvas.renderAll.bind(canvas)),overlay="/assets/cases/motog.png",overlay_line="/assets/cases/motog_l.png",$("#phone_type_name").val("8")):"4"===t.target.id?(canvas.setOverlayImage("/assets/cases/i6.png",canvas.renderAll.bind(canvas)),overlay="/assets/cases/i6.png",overlay_line="/assets/cases/i6_l.png",$("#phone_type_name").val("4")):"5"===t.target.id?(canvas.setOverlayImage("/assets/cases/i6t.png",canvas.renderAll.bind(canvas)),overlay="/assets/cases/i6t.png",overlay_line="/assets/cases/i6t_l.png",overlay_mobile="/assets/cases/i6t_mobile.png",overlay_line_mobile="/assets/cases/i6t_l_mobile.png",$("#phone_type_name").val("5")):"6"===t.target.id?(canvas.setOverlayImage("/assets/cases/i6pt.png",canvas.renderAll.bind(canvas)),overlay="/assets/cases/i6pt.png",overlay_line="/assets/cases/i6pt_l.png",$("#phone_type_name").val("6")):"1"===t.target.id&&(canvas.setOverlayImage("/assets/cases/i4t.png",canvas.renderAll.bind(canvas)),overlay="/assets/cases/i4t.png",overlay_line="/assets/cases/i4t_l.png",$("#phone_type_name").val("1"))}),$("canvas").mouseover(function(){canvas.setOverlayImage(null,canvas.renderAll.bind(canvas)),canvas.setOverlayImage(overlay_line,canvas.renderAll.bind(canvas))}),$("canvas").mouseout(function(){window.matchMedia("(max-width: 767px)").matches?canvas.setOverlayImage(overlay_mobile,canvas.renderAll.bind(canvas)):canvas.setOverlayImage(overlay,canvas.renderAll.bind(canvas)),canvas.deactivateAll().renderAll()}),$(".color_button").click(function(){var t=$(this).css("background-color"),e=rgb2hex(t);$("#back_color").attr("value",e),canvas.setBackgroundColor(t,canvas.renderAll.bind(canvas))}),$("#back_color").change(function(){var t=$(this).val();canvas.setBackgroundColor(t,canvas.renderAll.bind(canvas))});var t=$(".tab-content").width();$("#newtext").emojiPicker({height:"300px",width:t}),$("section .emoji").click(function(t){var e=$(t.target).attr("class").split("emoji-")[1],n=toUnicode(findEmoji(e).unicode),r=new fabric.Text(n,{fontSize:"70",top:150,left:250,selectable:!0});canvas.add(r)}),$("#scale-control").change(function(){var t=canvas.getActiveObject();t.scale(parseFloat(this.value)).setCoords(),canvas.renderAll()}),$("#angle-control").change(function(){var t=canvas.getActiveObject();t.setAngle(parseInt(this.value,10)).setCoords(),canvas.renderAll()}),$("#fontSizeDropDown li a").click(function(t){var e=$(t.target).text();$("#dropdownMenu1").html(e).width(40).append("<span class='caret'></span>")}),$("#fontFamilyDropDown li a").click(function(t){var e=$(t.target).text();$("#dropdownMenu2").html(e).width(300).append("<span class='caret'></span>")}),$("#textCreation").click(function(){$(".text-edition-box").toggle();var t="Editar texto",e="30",n="Century Gothic",r="black";text=new fabric.IText(t,{fontFamily:n,top:150,left:250,fill:r,fontSize:e}),canvas.add(text),canvas.setActiveObject(text),$("#text_to_canvas").val("Editar texto"),$("#text_to_canvas").on("input",function(){text.text=$(this).val(),canvas.renderAll()}),$(".color_button2").click(function(){var t=$(this).css("background-color"),e=rgb2hex(t);text.setColor(e),canvas.renderAll()}),$("#dropdownMenu2").bind("DOMSubtreeModified",function(){n=$(this).html().split("<")[0],text.fontFamily=n,canvas.renderAll()}),$("#dropdownMenu1").bind("DOMSubtreeModified",function(){e=$(this).html().split("<")[0],text.fontSize=e,canvas.renderAll(),text.setActiveObject()})}),$("#generar").click(function(){var t=canvas.overlayImage;canvas.overlayImage=null,canvas.deactivateAll().renderAll(),$("#image_to_print").val(canvas.toDataURL("image/png")),canvas.overlayImage=t,canvas.deactivateAll().renderAll(),$("#picture_url").val(canvas.toDataURL("image/png"))})}else $(".designtocase").click(function(t){imgData=t.target.src,fabric.Image.fromURL(imgData,function(t){canvas.add(t.set({left:0,top:0})),canvas.controlsAboveOverlay=!0,canvas.item(0).set({borderColor:"black",cornerColor:"black",cornerSize:20,transparentCorners:!1}),canvas.setActiveObject(canvas.item(0))},{crossOrigin:"anonymous"})}),$("#create").click(function(){canvas.deactivateAll().renderAll(),$("#newcaseimage").val(canvas.toDataURL("image/png"))});$(".uploadcare-widget-button-open")[0].innerHTML="Sube una imagen"},createCanvas=function(){canvas=new fabric.Canvas("c"),window.matchMedia("(max-width: 767px)").matches?(canvas.setHeight(300),canvas.setWidth(300),canvas.setOverlayImage("/assets/cases/i6t_mobile.png",canvas.renderAll.bind(canvas))):(canvas.setHeight(600),canvas.setWidth(600),canvas.setOverlayImage("/assets/cases/i6t.png",canvas.renderAll.bind(canvas)))},createImage=function(t){imgElement=$(".designtocase")[t],imgInstance=window.matchMedia("(max-width: 767px)").matches?new fabric.Image(imgElement,{height:300,width:300,scaleY:150/imgElement.width,scaleX:100/imgElement.width,left:0,top:0},{crossOrigin:"Anonymous"}):new fabric.Image(imgElement,{height:600,width:600,scaleY:300/imgElement.width,scaleX:200/imgElement.width,left:0,top:0},{crossOrigin:"Anonymous"})};$(document).ready(ready),$(document).on("page:load",ready);