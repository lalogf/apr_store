(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};$.rails.href=function(t){return t.attr("href")||t.data("href")||window.location.pathname},window.SmartListing=function(){function t(i){this.update_list=e(this.update_list,this),this.remove=e(this.remove,this),this.destroy=e(this.destroy,this),this.update=e(this.update,this),this.edit=e(this.edit,this),this.create=e(this.create,this),this.new_item=e(this.new_item,this),this.editable=e(this.editable,this),this.registerPopover=e(this.registerPopover,this),this.params=e(this.params,this),this.reload=e(this.reload,this),this.refresh=e(this.refresh,this),this.cancelEdit=e(this.cancelEdit,this),this.changeItemCount=e(this.changeItemCount,this),this.setAutoshow=e(this.setAutoshow,this),this.maxCount=e(this.maxCount,this),this.itemCount=e(this.itemCount,this),this.fadeLoaded=e(this.fadeLoaded,this),this.fadeLoading=e(this.fadeLoading,this),this.container=i,this.name=this.container.attr("id"),this.loading=this.container.find(t.config.class_name("loading")),this.content=this.container.find(t.config.class_name("content")),this.status=$(t.config.class_name("status")+" [data-"+t.config.data_attribute("main")+"='"+this.name+"']"),this.confirmed=null,this.popovers={},this.container.on("ajax:before",t.config.class_name("item_actions")+", "+t.config.class_name("pagination_container"),function(t){return function(){return t.fadeLoading()}}(this)),this.container.on("ajax:success",function(e){return function(i){var n;return $(i.target).is(t.config.class_name("item_actions")+" "+t.config.selector("item_action_destroy"))?(n=$(i.target).closest(t.config.class_name("editable")),1===e.container.find(t.config.class_name("editable")).length?(e.reload(),!1):(n.remove(),e.container.trigger("smart_listing:destroy",n),e.changeItemCount(-1),e.refresh(),e.fadeLoaded(),!1)):void 0}}(this)),this.container.on("click",t.config.selector("edit_cancel"),function(e){return function(i){var n;return n=$(i.currentTarget).closest(t.config.class_name("editable")),n.length>0?e.cancelEdit(n):(e.container.find(t.config.class_name("new_item_placeholder")).addClass(t.config["class"]("hidden")),e.container.find(t.config.class_name("new_item_action")).removeClass(t.config["class"]("hidden"))),e.setAutoshow(!1),!1}}(this)),this.container.on("click",t.config.class_name("item_actions")+" a[data-"+t.config.data_attribute("confirmation")+"]",function(){return function(e){return $.fn.smart_listing.confirm($(e.currentTarget),$(e.currentTarget).data(t.config.data_attribute("confirmation")))}}(this)),this.container.on("click",t.config.class_name("item_actions")+" a[data-"+t.config.data_attribute("popover")+"]",function(e){return function(i){var n;return n=$(i.currentTarget).data(t.config.data_attribute("popover")),jQuery.isFunction(e.popovers[n])?(e.popovers[n]($(i.currentTarget)),!1):void 0}}(this)),this.container.on("click","input[type=text]"+t.config.class_name("autoselect"),function(){return $(this).select()}),this.container.on("change",t.config.class_name("callback"),function(e){return function(i){var n,r,o;return n=$(i.currentTarget),o=n.closest(t.config.selector("row")).data(t.config.data_attribute("id")),r={},r[n.val()]=n.is(":checked"),$.ajax({beforeSend:function(t,e){return t.setRequestHeader("accept","*/*;q=0.5, "+e.accepts.script)},url:e.container.data(t.config.data_attribute("callback_href")),type:"POST",data:r})}}(this))}var i;return i=function(){function t(){}return t.options={global_options:{param_names:{page:"page",per_page:"per_page",sort:"sort"},array:!1,max_count:null,unlimited_per_page:!1,paginate:!0,memorize_per_page:!1,page_sizes:[10,20,50,100],kaminari_options:{theme:"smart_listing"},sort_dirs:[null,"asc","desc"]},constants:{classes:{main:"smart-listing",editable:"editable",content:"content",loading:"loading",status:"smart-listing-status",item_actions:"actions",new_item_placeholder:"new-item-placeholder",new_item_action:"new-item-action",new_item_button:"btn",hidden:"hidden",autoselect:"autoselect",callback:"callback",pagination_wrapper:"text-center",pagination_container:"pagination",pagination_per_page:"pagination-per-page text-center",inline_editing:"info",no_records:"no-records",limit:"smart-listing-limit",limit_alert:"smart-listing-limit-alert",controls:"smart-listing-controls",controls_reset:"reset",filtering:"filter",filtering_search:"glyphicon-search",filtering_cancel:"glyphicon-remove",filtering_disabled:"disabled",sortable:"sortable",icon_new:"glyphicon glyphicon-plus",icon_edit:"glyphicon glyphicon-pencil",icon_trash:"glyphicon glyphicon-trash",icon_inactive:"glyphicon glyphicon-remove-circle text-muted",icon_show:"glyphicon glyphicon-share-alt",icon_sort_none:"glyphicon glyphicon-resize-vertical",icon_sort_up:"glyphicon glyphicon-chevron-up",icon_sort_down:"glyphicon glyphicon-chevron-down",muted:"text-muted"},data_attributes:{main:"smart-listing",controls_initialized:"smart-listing-controls-initialized",confirmation:"confirmation",id:"id",href:"href",callback_href:"callback-href",max_count:"max-count",item_count:"item-count",inline_edit_backup:"smart-listing-edit-backup",params:"params",observed:"observed",autoshow:"autoshow",popover:"slpopover"},selectors:{item_action_destroy:"a.destroy",edit_cancel:"button.cancel",row:"tr",head:"thead",filtering_button:"button",filtering_icon:"button span",filtering_input:".filter input",pagination_count:".pagination-per-page .count"}}},t.merge=function(t){return $.extend(!0,this.options,t||$("body").data("smart-listing-config"))},t["class"]=function(t){return this.options.constants.classes[t]},t.class_name=function(t){return"."+this["class"](t)},t.data_attribute=function(t){return this.options.constants.data_attributes[t]},t.selector=function(t){return this.options.constants.selectors[t]},t}(),t.config=i,t.prototype.fadeLoading=function(){return $.fn.smart_listing.onLoading(this.content,this.loading)},t.prototype.fadeLoaded=function(){return $.fn.smart_listing.onLoaded(this.content,this.loading)},t.prototype.itemCount=function(){return parseInt(this.container.data(t.config.data_attribute("item_count")))},t.prototype.maxCount=function(){return parseInt(this.container.data(t.config.data_attribute("max_count")))},t.prototype.setAutoshow=function(e){return this.container.data(t.config.data_attribute("autoshow"),e)},t.prototype.changeItemCount=function(e){var i;return i=this.container.data(t.config.data_attribute("item_count"))+e,this.container.data(t.config.data_attribute("item_count"),i),this.container.find(t.config.selector("pagination_count")).html(i)},t.prototype.cancelEdit=function(e){return e.data(t.config.data_attribute("inline_edit_backup"))?(e.html(e.data(t.config.data_attribute("inline_edit_backup"))),e.removeClass(t.config["class"]("inline_editing")),e.removeData(t.config.data_attribute("inline_edit_backup"))):void 0},t.prototype.refresh=function(){var e,i,n;return i=this.content.find(t.config.selector("head")),e=this.content.find(t.config.class_name("pagination_per_page")),n=this.content.find(t.config.class_name("no_records")),0===this.itemCount()?(i.hide(),e.hide(),n.show()):(i.show(),e.show(),n.hide()),this.maxCount()&&(this.itemCount()>=this.maxCount()?(this.container.find(t.config.class_name("new_item_placeholder")).addClass(t.config["class"]("hidden")),this.container.find(t.config.class_name("new_item_action")).addClass(t.config["class"]("hidden"))):this.container.data(t.config.data_attribute("autoshow"))?(this.container.find(t.config.class_name("new_item_placeholder")).removeClass(t.config["class"]("hidden")),this.container.find(t.config.class_name("new_item_action")).addClass(t.config["class"]("hidden"))):(this.container.find(t.config.class_name("new_item_placeholder")).addClass(t.config["class"]("hidden")),this.container.find(t.config.class_name("new_item_action")).removeClass(t.config["class"]("hidden")))),this.status.each(function(e){return function(i,n){return $(n).find(t.config.class_name("limit")).html(e.maxCount()-e.itemCount()),e.maxCount()-e.itemCount()===0?$(n).find(t.config.class_name("limit_alert")).show():$(n).find(t.config.class_name("limit_alert")).hide()}}(this))},t.prototype.reload=function(){return $.rails.handleRemote(this.container)},t.prototype.params=function(e){return e?this.container.data(t.config.data_attribute("params"),e):this.container.data(t.config.data_attribute("params"))},t.prototype.registerPopover=function(t,e){return this.popovers[t]=e},t.prototype.editable=function(e){return this.container.find(t.config.class_name("editable")+"[data-"+t.config.data_attribute("id")+"="+e+"]")},t.prototype.new_item=function(e){var i,n;return!this.maxCount()||this.itemCount()<this.maxCount()?(i=this.container.find(t.config.class_name("new_item_action")),n=this.container.find(t.config.class_name("new_item_placeholder")).addClass(t.config["class"]("hidden")),this.container.find(t.config.class_name("editable")).each(function(t){return function(e,i){return t.cancelEdit($(i))}}(this)),i.addClass(t.config["class"]("hidden")),n.removeClass(t.config["class"]("hidden")),n.html(e),n.addClass(t.config["class"]("inline_editing")),this.fadeLoaded()):void 0},t.prototype.create=function(e,i,n){var r,o,s;return o=this.container.find(t.config.class_name("new_item_action")),s=this.container.find(t.config.class_name("new_item_placeholder")),i?(s.addClass(t.config["class"]("hidden")),o.removeClass(t.config["class"]("hidden")),r=$("<tr />").addClass(t.config["class"]("editable")),r.attr("data-"+t.config.data_attribute("id"),e),r.html(n),s.before(r),this.container.trigger("smart_listing:create:success",r),this.changeItemCount(1),this.refresh()):(s.html(n),this.container.trigger("smart_listing:create:fail",s)),this.fadeLoaded()},t.prototype.edit=function(e,i){var n;return this.container.find(t.config.class_name("editable")).each(function(t){return function(e,i){return t.cancelEdit($(i))}}(this)),this.container.find(t.config.class_name("new_item_placeholder")).addClass(t.config["class"]("hidden")),this.container.find(t.config.class_name("new_item_action")).removeClass(t.config["class"]("hidden")),n=this.editable(e),n.data(t.config.data_attribute("inline_edit_backup"),n.html()),n.html(i),n.addClass(t.config["class"]("inline_editing")),this.container.trigger("smart_listing:edit",n),this.fadeLoaded()},t.prototype.update=function(e,i,n){var r;return r=this.editable(e),i?(r.removeClass(t.config["class"]("inline_editing")),r.removeData(t.config.data_attribute("inline_edit_backup")),r.html(n),this.container.trigger("smart_listing:update:success",r),this.refresh()):(r.html(n),this.container.trigger("smart_listing:update:fail",r)),this.fadeLoaded()},t.prototype.destroy=function(){},t.prototype.remove=function(t){var e;return e=this.editable(t),e.remove(),this.container.trigger("smart_listing:remove",e)},t.prototype.update_list=function(e,i){return this.container.data(t.config.data_attribute("params"),$.extend(this.container.data(t.config.data_attribute("params")),i[t.config.data_attribute("params")])),this.container.data(t.config.data_attribute("max_count"),i[t.config.data_attribute("max_count")]),this.container.data(t.config.data_attribute("item_count"),i[t.config.data_attribute("item_count")]),this.content.html(e),this.refresh(),this.fadeLoaded(),this.container.trigger("smart_listing:update_list",this.container)},t}(),$.fn.smart_listing=function(){var t;return t=$(this).map(function(){return $(this).data(SmartListing.config.data_attribute("main"))||$(this).data(SmartListing.config.data_attribute("main"),new SmartListing($(this))),$(this).data(SmartListing.config.data_attribute("main"))}),1===t.length?t[0]:t},$.fn.smart_listing.observeField=function(t,e){var i,n,r,o;return null==e&&(e={}),n=null,r=null,o={onFilled:function(){},onEmpty:function(){},onChange:function(){}},o=$.extend(o,e),i=function(){var e;return t.val().length>0?o.onFilled():o.onEmpty(),t.val()!==r||0===t.val().length?(e=t.val(),o.onChange()):void 0},t.data(SmartListing.config.data_attribute("observed"),!0),t.bind("keydown",function(){return n&&clearTimeout(n),n=setTimeout(function(){return i()},400)})},$.fn.smart_listing.showPopover=function(t,e){return t.popover("destroy"),t.popover({content:e,html:!0,trigger:"manual",title:null}),t.popover("show")},$.fn.smart_listing.showConfirmation=function(t,e,i){var n;return n=function(t,e){var n;return n=$("<div/>").addClass("confirmation_box"),n.append($("<p/>").html(e)),n.append($("<p/>").append($("<button/>").html("Yes").addClass("btn btn-danger ").click(function(){return function(e){var n;return n=$(e.currentTarget).closest(SmartListing.config.class_name("editable")),i(t),$(t).click(),$(t).popover("destroy")}}(this))).append(" ").append($("<button/>").html("No").addClass("btn btn-small").click(function(){return function(e){var i;return i=$(e.currentTarget).closest(SmartListing.config.class_name("editable")),$(t).popover("destroy")}}(this))))},$.fn.smart_listing.showPopover(t,n(t,e))},$.fn.smart_listing.confirm=function(t,e){return t.data("confirmed")?(t.data("confirmed",!1),!0):($.fn.smart_listing.showConfirmation(t,e,function(){return function(t){return t.data("confirmed",!0)}}(this)),!1)},$.fn.smart_listing.onLoading=function(t,e){return t.stop(!0).fadeTo(500,.2),e.show(),e.stop(!0).fadeTo(500,1)},$.fn.smart_listing.onLoaded=function(t,e){return t.stop(!0).fadeTo(500,1),e.stop(!0).fadeTo(500,0,function(){return function(){return e.hide()}}(this))},$.fn.smart_listing_controls=function(){var t;return t=function(t){var e,i,n;return e=$("#"+t.data(SmartListing.config.data_attribute("main"))),n=e.smart_listing(),i={},$.each(t.serializeArray(),function(t,e){return i[e.name]=e.value}),i=$.extend(n.params(),i),n.params(i),e.trigger("ajax:before"),n.reload()},$(this).each(function(){var e,i,n;if(!$(this).data(SmartListing.config.data_attribute("controls_initialized")))return $(this).data(SmartListing.config.data_attribute("controls_initialized"),!0),e=$(this),n=$("#"+e.data(SmartListing.config.data_attribute("main"))),i=e.find(SmartListing.config.class_name("controls_reset")),e.submit(function(){return t(e),!1}),e.find("input, select").change(function(){return $(this).data(SmartListing.config.data_attribute("observed"))?void 0:t(e)}),$.fn.smart_listing_controls.filter(e.find(SmartListing.config.class_name("filtering")))})},$.fn.smart_listing_controls.filter=function(t){var e,i,n,r;return n=t.closest("form"),e=n.find(SmartListing.config.selector("filtering_button")),r=n.find(SmartListing.config.selector("filtering_icon")),i=n.find(SmartListing.config.selector("filtering_input")),$.fn.smart_listing.observeField(i,{onFilled:function(){return r.removeClass(SmartListing.config["class"]("filtering_search")),r.addClass(SmartListing.config["class"]("filtering_cancel")),e.removeClass(SmartListing.config["class"]("filtering_disabled"))},onEmpty:function(){return r.addClass(SmartListing.config["class"]("filtering_search")),r.removeClass(SmartListing.config["class"]("filtering_cancel")),e.addClass(SmartListing.config["class"]("filtering_disabled"))},onChange:function(){return n.submit()}}),e.click(function(){return i.val().length>0&&(i.val(""),i.trigger("keydown")),!1})},t=function(){return $(SmartListing.config.class_name("main")).smart_listing(),$(SmartListing.config.class_name("controls")).smart_listing_controls()},$(document).ready(t),$(document).on("page:load",t)}).call(this);