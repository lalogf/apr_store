(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};$.rails.href=function(e){return e.attr("href")||e.data("href")||window.location.pathname},window.SmartListing=function(){function e(i){this.update_list=t(this.update_list,this),this.remove=t(this.remove,this),this.destroy=t(this.destroy,this),this.update=t(this.update,this),this.edit=t(this.edit,this),this.create=t(this.create,this),this.new_item=t(this.new_item,this),this.editable=t(this.editable,this),this.registerPopover=t(this.registerPopover,this),this.params=t(this.params,this),this.reload=t(this.reload,this),this.refresh=t(this.refresh,this),this.cancelEdit=t(this.cancelEdit,this),this.changeItemCount=t(this.changeItemCount,this),this.setAutoshow=t(this.setAutoshow,this),this.maxCount=t(this.maxCount,this),this.itemCount=t(this.itemCount,this),this.fadeLoaded=t(this.fadeLoaded,this),this.fadeLoading=t(this.fadeLoading,this),this.container=i,this.name=this.container.attr("id"),this.loading=this.container.find(e.config.class_name("loading")),this.content=this.container.find(e.config.class_name("content")),this.status=$(e.config.class_name("status")+" [data-"+e.config.data_attribute("main")+"='"+this.name+"']"),this.confirmed=null,this.popovers={},this.container.on("ajax:before",e.config.class_name("item_actions")+", "+e.config.class_name("pagination_container"),function(e){return function(){return e.fadeLoading()}}(this)),this.container.on("ajax:success",function(t){return function(i){var o;return $(i.target).is(e.config.class_name("item_actions")+" "+e.config.selector("item_action_destroy"))?(o=$(i.target).closest(e.config.class_name("editable")),1===t.container.find(e.config.class_name("editable")).length?(t.reload(),!1):(o.remove(),t.container.trigger("smart_listing:destroy",o),t.changeItemCount(-1),t.refresh(),t.fadeLoaded(),!1)):void 0}}(this)),this.container.on("click",e.config.selector("edit_cancel"),function(t){return function(i){var o;return o=$(i.currentTarget).closest(e.config.class_name("editable")),o.length>0?t.cancelEdit(o):(t.container.find(e.config.class_name("new_item_placeholder")).addClass(e.config["class"]("hidden")),t.container.find(e.config.class_name("new_item_action")).removeClass(e.config["class"]("hidden"))),t.setAutoshow(!1),!1}}(this)),this.container.on("click",e.config.class_name("item_actions")+" a[data-"+e.config.data_attribute("confirmation")+"]",function(){return function(t){return $.fn.smart_listing.confirm($(t.currentTarget),$(t.currentTarget).data(e.config.data_attribute("confirmation")))}}(this)),this.container.on("click",e.config.class_name("item_actions")+" a[data-"+e.config.data_attribute("popover")+"]",function(t){return function(i){var o;return o=$(i.currentTarget).data(e.config.data_attribute("popover")),jQuery.isFunction(t.popovers[o])?(t.popovers[o]($(i.currentTarget)),!1):void 0}}(this)),this.container.on("click","input[type=text]"+e.config.class_name("autoselect"),function(){return $(this).select()}),this.container.on("change",e.config.class_name("callback"),function(t){return function(i){var o,n,r;return o=$(i.currentTarget),r=o.closest(e.config.selector("row")).data(e.config.data_attribute("id")),n={},n[o.val()]=o.is(":checked"),$.ajax({beforeSend:function(e,t){return e.setRequestHeader("accept","*/*;q=0.5, "+t.accepts.script)},url:t.container.data(e.config.data_attribute("callback_href")),type:"POST",data:n})}}(this))}var i;return i=function(){function e(){}return e.options={global_options:{param_names:{page:"page",per_page:"per_page",sort:"sort"},array:!1,max_count:null,unlimited_per_page:!1,paginate:!0,memorize_per_page:!1,page_sizes:[10,20,50,100],kaminari_options:{theme:"smart_listing"},sort_dirs:[null,"asc","desc"]},constants:{classes:{main:"smart-listing",editable:"editable",content:"content",loading:"loading",status:"smart-listing-status",item_actions:"actions",new_item_placeholder:"new-item-placeholder",new_item_action:"new-item-action",new_item_button:"btn",hidden:"hidden",autoselect:"autoselect",callback:"callback",pagination_wrapper:"text-center",pagination_container:"pagination",pagination_per_page:"pagination-per-page text-center",inline_editing:"info",no_records:"no-records",limit:"smart-listing-limit",limit_alert:"smart-listing-limit-alert",controls:"smart-listing-controls",controls_reset:"reset",filtering:"filter",filtering_search:"glyphicon-search",filtering_cancel:"glyphicon-remove",filtering_disabled:"disabled",sortable:"sortable",icon_new:"glyphicon glyphicon-plus",icon_edit:"glyphicon glyphicon-pencil",icon_trash:"glyphicon glyphicon-trash",icon_inactive:"glyphicon glyphicon-remove-circle text-muted",icon_show:"glyphicon glyphicon-share-alt",icon_sort_none:"glyphicon glyphicon-resize-vertical",icon_sort_up:"glyphicon glyphicon-chevron-up",icon_sort_down:"glyphicon glyphicon-chevron-down",muted:"text-muted"},data_attributes:{main:"smart-listing",controls_initialized:"smart-listing-controls-initialized",confirmation:"confirmation",id:"id",href:"href",callback_href:"callback-href",max_count:"max-count",item_count:"item-count",inline_edit_backup:"smart-listing-edit-backup",params:"params",observed:"observed",autoshow:"autoshow",popover:"slpopover"},selectors:{item_action_destroy:"a.destroy",edit_cancel:"button.cancel",row:"tr",head:"thead",filtering_button:"button",filtering_icon:"button span",filtering_input:".filter input",pagination_count:".pagination-per-page .count"}}},e.merge=function(e){return $.extend(!0,this.options,e||$("body").data("smart-listing-config"))},e["class"]=function(e){return this.options.constants.classes[e]},e.class_name=function(e){return"."+this["class"](e)},e.data_attribute=function(e){return this.options.constants.data_attributes[e]},e.selector=function(e){return this.options.constants.selectors[e]},e}(),e.config=i,e.prototype.fadeLoading=function(){return $.fn.smart_listing.onLoading(this.content,this.loading)},e.prototype.fadeLoaded=function(){return $.fn.smart_listing.onLoaded(this.content,this.loading)},e.prototype.itemCount=function(){return parseInt(this.container.data(e.config.data_attribute("item_count")))},e.prototype.maxCount=function(){return parseInt(this.container.data(e.config.data_attribute("max_count")))},e.prototype.setAutoshow=function(t){return this.container.data(e.config.data_attribute("autoshow"),t)},e.prototype.changeItemCount=function(t){var i;return i=this.container.data(e.config.data_attribute("item_count"))+t,this.container.data(e.config.data_attribute("item_count"),i),this.container.find(e.config.selector("pagination_count")).html(i)},e.prototype.cancelEdit=function(t){return t.data(e.config.data_attribute("inline_edit_backup"))?(t.html(t.data(e.config.data_attribute("inline_edit_backup"))),t.removeClass(e.config["class"]("inline_editing")),t.removeData(e.config.data_attribute("inline_edit_backup"))):void 0},e.prototype.refresh=function(){var t,i,o;return i=this.content.find(e.config.selector("head")),t=this.content.find(e.config.class_name("pagination_per_page")),o=this.content.find(e.config.class_name("no_records")),0===this.itemCount()?(i.hide(),t.hide(),o.show()):(i.show(),t.show(),o.hide()),this.maxCount()&&(this.itemCount()>=this.maxCount()?(this.container.find(e.config.class_name("new_item_placeholder")).addClass(e.config["class"]("hidden")),this.container.find(e.config.class_name("new_item_action")).addClass(e.config["class"]("hidden"))):this.container.data(e.config.data_attribute("autoshow"))?(this.container.find(e.config.class_name("new_item_placeholder")).removeClass(e.config["class"]("hidden")),this.container.find(e.config.class_name("new_item_action")).addClass(e.config["class"]("hidden"))):(this.container.find(e.config.class_name("new_item_placeholder")).addClass(e.config["class"]("hidden")),this.container.find(e.config.class_name("new_item_action")).removeClass(e.config["class"]("hidden")))),this.status.each(function(t){return function(i,o){return $(o).find(e.config.class_name("limit")).html(t.maxCount()-t.itemCount()),t.maxCount()-t.itemCount()===0?$(o).find(e.config.class_name("limit_alert")).show():$(o).find(e.config.class_name("limit_alert")).hide()}}(this))},e.prototype.reload=function(){return $.rails.handleRemote(this.container)},e.prototype.params=function(t){return t?this.container.data(e.config.data_attribute("params"),t):this.container.data(e.config.data_attribute("params"))},e.prototype.registerPopover=function(e,t){return this.popovers[e]=t},e.prototype.editable=function(t){return this.container.find(e.config.class_name("editable")+"[data-"+e.config.data_attribute("id")+"="+t+"]")},e.prototype.new_item=function(t){var i,o;return!this.maxCount()||this.itemCount()<this.maxCount()?(i=this.container.find(e.config.class_name("new_item_action")),o=this.container.find(e.config.class_name("new_item_placeholder")).addClass(e.config["class"]("hidden")),this.container.find(e.config.class_name("editable")).each(function(e){return function(t,i){return e.cancelEdit($(i))}}(this)),i.addClass(e.config["class"]("hidden")),o.removeClass(e.config["class"]("hidden")),o.html(t),o.addClass(e.config["class"]("inline_editing")),this.fadeLoaded()):void 0},e.prototype.create=function(t,i,o){var n,r,a;return r=this.container.find(e.config.class_name("new_item_action")),a=this.container.find(e.config.class_name("new_item_placeholder")),i?(a.addClass(e.config["class"]("hidden")),r.removeClass(e.config["class"]("hidden")),n=$("<tr />").addClass(e.config["class"]("editable")),n.attr("data-"+e.config.data_attribute("id"),t),n.html(o),a.before(n),this.container.trigger("smart_listing:create:success",n),this.changeItemCount(1),this.refresh()):(a.html(o),this.container.trigger("smart_listing:create:fail",a)),this.fadeLoaded()},e.prototype.edit=function(t,i){var o;return this.container.find(e.config.class_name("editable")).each(function(e){return function(t,i){return e.cancelEdit($(i))}}(this)),this.container.find(e.config.class_name("new_item_placeholder")).addClass(e.config["class"]("hidden")),this.container.find(e.config.class_name("new_item_action")).removeClass(e.config["class"]("hidden")),o=this.editable(t),o.data(e.config.data_attribute("inline_edit_backup"),o.html()),o.html(i),o.addClass(e.config["class"]("inline_editing")),this.container.trigger("smart_listing:edit",o),this.fadeLoaded()},e.prototype.update=function(t,i,o){var n;return n=this.editable(t),i?(n.removeClass(e.config["class"]("inline_editing")),n.removeData(e.config.data_attribute("inline_edit_backup")),n.html(o),this.container.trigger("smart_listing:update:success",n),this.refresh()):(n.html(o),this.container.trigger("smart_listing:update:fail",n)),this.fadeLoaded()},e.prototype.destroy=function(){},e.prototype.remove=function(e){var t;return t=this.editable(e),t.remove(),this.container.trigger("smart_listing:remove",t)},e.prototype.update_list=function(t,i){return this.container.data(e.config.data_attribute("params"),$.extend(this.container.data(e.config.data_attribute("params")),i[e.config.data_attribute("params")])),this.container.data(e.config.data_attribute("max_count"),i[e.config.data_attribute("max_count")]),this.container.data(e.config.data_attribute("item_count"),i[e.config.data_attribute("item_count")]),this.content.html(t),this.refresh(),this.fadeLoaded(),this.container.trigger("smart_listing:update_list",this.container)},e}(),$.fn.smart_listing=function(){var e;return e=$(this).map(function(){return $(this).data(SmartListing.config.data_attribute("main"))||$(this).data(SmartListing.config.data_attribute("main"),new SmartListing($(this))),$(this).data(SmartListing.config.data_attribute("main"))}),1===e.length?e[0]:e},$.fn.smart_listing.observeField=function(e,t){var i,o,n,r;return null==t&&(t={}),o=null,n=null,r={onFilled:function(){},onEmpty:function(){},onChange:function(){}},r=$.extend(r,t),i=function(){var t;return e.val().length>0?r.onFilled():r.onEmpty(),e.val()!==n||0===e.val().length?(t=e.val(),r.onChange()):void 0},e.data(SmartListing.config.data_attribute("observed"),!0),e.bind("keydown",function(){return o&&clearTimeout(o),o=setTimeout(function(){return i()},400)})},$.fn.smart_listing.showPopover=function(e,t){return e.popover("destroy"),e.popover({content:t,html:!0,trigger:"manual",title:null}),e.popover("show")},$.fn.smart_listing.showConfirmation=function(e,t,i){var o;return o=function(e,t){var o;return o=$("<div/>").addClass("confirmation_box"),o.append($("<p/>").html(t)),o.append($("<p/>").append($("<button/>").html("Yes").addClass("btn btn-danger ").click(function(){return function(t){var o;return o=$(t.currentTarget).closest(SmartListing.config.class_name("editable")),i(e),$(e).click(),$(e).popover("destroy")}}(this))).append(" ").append($("<button/>").html("No").addClass("btn btn-small").click(function(){return function(t){var i;return i=$(t.currentTarget).closest(SmartListing.config.class_name("editable")),$(e).popover("destroy")}}(this))))},$.fn.smart_listing.showPopover(e,o(e,t))},$.fn.smart_listing.confirm=function(e,t){return e.data("confirmed")?(e.data("confirmed",!1),!0):($.fn.smart_listing.showConfirmation(e,t,function(){return function(e){return e.data("confirmed",!0)}}(this)),!1)},$.fn.smart_listing.onLoading=function(e,t){return e.stop(!0).fadeTo(500,.2),t.show(),t.stop(!0).fadeTo(500,1)},$.fn.smart_listing.onLoaded=function(e,t){return e.stop(!0).fadeTo(500,1),t.stop(!0).fadeTo(500,0,function(){return function(){return t.hide()}}(this))},$.fn.smart_listing_controls=function(){var e;return e=function(e){var t,i,o;return t=$("#"+e.data(SmartListing.config.data_attribute("main"))),o=t.smart_listing(),i={},$.each(e.serializeArray(),function(e,t){return i[t.name]=t.value}),i=$.extend(o.params(),i),o.params(i),t.trigger("ajax:before"),o.reload()},$(this).each(function(){var t,i,o;if(!$(this).data(SmartListing.config.data_attribute("controls_initialized")))return $(this).data(SmartListing.config.data_attribute("controls_initialized"),!0),t=$(this),o=$("#"+t.data(SmartListing.config.data_attribute("main"))),i=t.find(SmartListing.config.class_name("controls_reset")),t.submit(function(){return e(t),!1}),t.find("input, select").change(function(){return $(this).data(SmartListing.config.data_attribute("observed"))?void 0:e(t)}),$.fn.smart_listing_controls.filter(t.find(SmartListing.config.class_name("filtering")))})},$.fn.smart_listing_controls.filter=function(e){var t,i,o,n;return o=e.closest("form"),t=o.find(SmartListing.config.selector("filtering_button")),n=o.find(SmartListing.config.selector("filtering_icon")),i=o.find(SmartListing.config.selector("filtering_input")),$.fn.smart_listing.observeField(i,{onFilled:function(){return n.removeClass(SmartListing.config["class"]("filtering_search")),n.addClass(SmartListing.config["class"]("filtering_cancel")),t.removeClass(SmartListing.config["class"]("filtering_disabled"))},onEmpty:function(){return n.addClass(SmartListing.config["class"]("filtering_search")),n.removeClass(SmartListing.config["class"]("filtering_cancel")),t.addClass(SmartListing.config["class"]("filtering_disabled"))},onChange:function(){return o.submit()}}),t.click(function(){return i.val().length>0&&(i.val(""),i.trigger("keydown")),!1})},e=function(){return $(SmartListing.config.class_name("main")).smart_listing(),$(SmartListing.config.class_name("controls")).smart_listing_controls()},$(document).ready(e),$(document).on("page:load",e)}).call(this);